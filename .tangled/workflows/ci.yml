when:
  - event: ["push", "pull_request"]
    branch: main

engine: nixery

environment:
  USER: root
  CACHIX_NAME: overby-me

steps:
  - name: "Setup Cachix"
    command: |
      nix-env -iA cachix -f https://cachix.org/api/v1/install
      mkdir -p /tangled/home/.config/nix
      touch /tangled/home/.config/nix/nix.conf
      cachix use $CACHIX_NAME
  - name: "Nix flake check"
    command: |
      cachix watch-exec $CACHIX_NAME nix flake check
